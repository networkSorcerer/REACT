import axios, { AxiosRequestConfig, AxiosResponse } from "axios";
import { useEffect, useState } from "react";
import { useNavigate, useParams } from "react-router-dom"
import { useRecoilState } from "recoil";
import { modalState } from "../../../../stores/modalState";
import { ContentBox } from "../../../common/ContentBox/ContentBox";
import { Button } from "../../../common/Button/Button";
import { StyledTable, StyledTd, StyledTh } from "../../../common/styled/StyledTable";
import KakaoMap from "../StorageLocation/KakaoMap";

export interface IStorageItemList{
    storage_code : number;
    storage_name : string;
    item_name : string;
    item_price : number;
    inventory_count : number;
    item_code : string;
}

export interface IStorageItemListResponse {
    resultMsg : string;
    map : IStorageItemList[];
}

export const StorageDetailMain =() =>{
    const {storage_code} = useParams();
    const navigate = useNavigate();
    const [StorageItemList, setStorageItemList] = useState<IStorageItemList[]>();
    const [item_code, setItem_code] = useState<string>();
    const [modal, setModal] = useRecoilState(modalState);

    useEffect(()=>{
        searchStorageItemList();
    },[storage_code]);
   
    const onPostSuccess =() =>{
        setModal(!modal);
    }

    const searchStorageItemList =()=>{
        const postAction:AxiosRequestConfig ={
            method :'POST',
            url : '/management/warehouseDetail2.do',
            data :{storage_code: storage_code},
            headers : {
                'Content-Type':'application/json',
            },
        };
        axios(postAction).then((res: AxiosResponse<IStorageItemListResponse>)=>{
            setStorageItemList(res.data.map);
        })
    } //창고이름	상품이름	상품가격	상품개수
   
    return(
        <>
        <ContentBox>창고 제품 리스트</ContentBox>
        <Button onClick={()=> navigate(-1)}>뒤로가기</Button>
        <Button >신규등록</Button>
        <KakaoMap center={{
                lat: 0,
                lng: 0
            }} ></KakaoMap>
        <StyledTable>
           
            <thead>
                <tr>
                <StyledTh size={10}>창고이름</StyledTh>
                <StyledTh size={10}>상품이름</StyledTh>
                <StyledTh size={7}>상품가격</StyledTh>
                <StyledTh size={10}>상품개수</StyledTh>
                </tr>
            </thead>
            <tbody>
                {StorageItemList && StorageItemList.length > 0? (
                    StorageItemList.map((a)=>{
                        return(
                            <tr key={a.storage_code}>
                                <StyledTd>{a.storage_name}</StyledTd>
                                <StyledTd>{a.item_name}</StyledTd>
                                <StyledTd>{a.item_price}</StyledTd>
                                <StyledTd>{a.inventory_count}</StyledTd>
                            </tr>
                        )
                    })
                ):(
                    <tr>
                        <StyledTd colSpan={4}>데이터가 없습니다</StyledTd>
                    </tr>
                )}
            </tbody>
        </StyledTable>
        </>
    )
}